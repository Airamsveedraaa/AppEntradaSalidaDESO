<Window x:Class="AppEntradaSalidaDESO.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AppEntradaSalidaDESO"
        xmlns:vm="clr-namespace:AppEntradaSalidaDESO.ViewModels"
        mc:Ignorable="d"
        Title="Simulador de Planificación de Discos - DESO" Height="750" Width="1100"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- Estilo básico para TextBoxes con Header -->
        <Style TargetType="TextBlock" x:Key="LabelStyle">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,10,0,5"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="380"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Panel de Configuración -->
        <Border Grid.Column="0" Background="#F5F5F5" Padding="15" CornerRadius="8">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <TextBlock Text="Configuración del Ejercicio" FontSize="20" FontWeight="Bold" Margin="0,0,0,15"/>

                    <!-- Algoritmo -->
                    <TextBlock Text="Algoritmo" Style="{StaticResource LabelStyle}"/>
                    <ComboBox ItemsSource="{Binding Algorithms}" 
                              SelectedItem="{Binding SelectedAlgorithmName}"
                              Padding="10" FontSize="14"/>

                    <!-- Peticiones -->
                    <TextBlock Text="Peticiones (separadas por comas)" Style="{StaticResource LabelStyle}"/>
                    <TextBox Text="{Binding RequestsInput, UpdateSourceTrigger=PropertyChanged}" 
                             Padding="5" FontSize="14" Height="60" TextWrapping="Wrap"
                             ToolTip="Ejemplo: 98, 183, 37, 122, 14, 124, 65, 67"/>

                    <!-- Configuración del Disco -->
                    <TextBlock Text="Configuración del Disco" FontSize="16" FontWeight="Bold" Margin="0,15,0,5" Foreground="#007ACC"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Min Cilindro" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding MinCylinder}" Padding="5" FontSize="14"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Max Cilindro" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding MaxCylinder}" Padding="5" FontSize="14"/>
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Posición Inicial Cabezal" Style="{StaticResource LabelStyle}"/>
                    <TextBox Text="{Binding InitialPosition}" Padding="5" FontSize="14"/>

                    <!-- Dirección (Condicional) -->
                    <StackPanel Visibility="{Binding IsDirectionRequired, Converter={StaticResource BoolToVis}}">
                        <TextBlock Text="Dirección Inicial" Style="{StaticResource LabelStyle}"/>
                        <ComboBox SelectedItem="{Binding SelectedDirection}" Padding="10" FontSize="14">
                            <ComboBoxItem Content="up" Tag="up"/>
                            <ComboBoxItem Content="down" Tag="down"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- Geometría del Disco -->
                    <GroupBox Header="Geometría del Disco" Margin="0,15,0,0" Padding="10" BorderBrush="#CCC">
                        <StackPanel>
                            <CheckBox Content="Usar conversión de bloques a pistas" 
                                      IsChecked="{Binding UseBlockConversion}"
                                      Margin="0,5" FontWeight="SemiBold"/>
                            
                            <Grid Margin="0,10" IsEnabled="{Binding UseBlockConversion}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="Sectores/pista" FontSize="11" Margin="0,0,0,3"/>
                                    <TextBox Text="{Binding SectorsPerTrack}" Padding="5" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Row="0" Grid.Column="2">
                                    <TextBlock Text="Cilindros" FontSize="11" Margin="0,0,0,3"/>
                                    <TextBox Text="{Binding Cylinders}" Padding="5" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,5,0,0">
                                    <TextBlock Text="Caras" FontSize="11" Margin="0,0,0,3"/>
                                    <TextBox Text="{Binding Faces}" Padding="5" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,5,0,0">
                                    <TextBlock Text="Tamaño sector (B)" FontSize="11" Margin="0,0,0,3"/>
                                    <TextBox Text="{Binding SectorSize}" Padding="5" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,5,0,0">
                                    <TextBlock Text="Tamaño bloque (B)" FontSize="11" Margin="0,0,0,3"/>
                                    <TextBox Text="{Binding BlockSize}" Padding="5" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.Column="2" Margin="0,5,0,0">
                                    <TextBlock Text="Bloques/cilindro" FontSize="11" Margin="0,0,0,3"/>
                                    <Border Background="#E8F4FF" Padding="5" CornerRadius="3">
                                        <TextBlock Text="{Binding BlocksPerCylinder, StringFormat=F2}" 
                                                   FontWeight="Bold" Foreground="#007ACC" 
                                                   VerticalAlignment="Center" FontSize="12"/>
                                    </Border>
                                </StackPanel>
                            </Grid>

                            <Button Content="Calcular Bloques por Cilindro" 
                                    Command="{Binding CalculateBlocksPerCylinderCommand}"
                                    Margin="0,10,0,0" Padding="8" FontSize="12"
                                    IsEnabled="{Binding UseBlockConversion}"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Cálculos de Tiempo -->
                    <GroupBox Header="Cálculos de Tiempo" Margin="0,10,0,0" Padding="10" BorderBrush="#CCC">
                        <StackPanel>
                            <CheckBox Content="Calcular tiempos de acceso" 
                                      IsChecked="{Binding CalculateAccessTime}"
                                      Margin="0,5" FontWeight="SemiBold"/>
                            
                            <Grid Margin="0,10" IsEnabled="{Binding CalculateAccessTime}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="Tiempo búsqueda (ms/pista)" FontSize="11" Margin="0,0,0,3"/>
                                    <TextBox Text="{Binding SeekTimePerTrack}" Padding="5" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Row="0" Grid.Column="2">
                                    <TextBlock Text="RPM del disco" FontSize="11" Margin="0,0,0,3"/>
                                    <TextBox Text="{Binding RPM}" Padding="5" FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,5,0,0">
                                    <TextBlock Text="Sectores/bloque" FontSize="11" Margin="0,0,0,3"/>
                                    <TextBox Text="{Binding SectorsPerBlock}" Padding="5" FontSize="12"/>
                                </StackPanel>
                            </Grid>

                            <TextBlock TextWrapping="Wrap" FontSize="10" Foreground="Gray" Margin="0,5">
                                <Run Text="Nota: Los sectores/bloque se calculan automáticamente si usas conversión de bloques."/>
                            </TextBlock>
                        </StackPanel>
                    </GroupBox>

                    <!-- Botón Ejecutar -->
                    <Button Command="{Binding ExecuteCommand}" 
                            Content="Simular" 
                            Margin="0,20,0,0" 
                            Padding="10" 
                            Background="#007ACC" 
                            Foreground="White" 
                            FontWeight="Bold" 
                            FontSize="16"
                            Cursor="Hand"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Panel de Resultados -->
        <Grid Grid.Column="1" Margin="20,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Text="Resultados de la Simulación" FontSize="20" FontWeight="Bold" Margin="0,0,0,10"/>

            <TextBox Grid.Row="1" 
                     Text="{Binding ResultOutput, Mode=OneWay}" 
                     IsReadOnly="True" 
                     Height="150"
                     VerticalScrollBarVisibility="Auto" 
                     FontFamily="Consolas" 
                     FontSize="13" 
                     Padding="10"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Margin="0,0,0,10"/>
                     
            <DataGrid Grid.Row="1" Margin="0,160,0,0"
                      ItemsSource="{Binding StepsTable}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      GridLinesVisibility="Horizontal"
                      Background="White"
                      Padding="5">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="#" Binding="{Binding Step}" Width="50"/>
                    <DataGridTextColumn Header="Pos. Actual" Binding="{Binding From}" Width="100"/>
                    <DataGridTextColumn Header="Petición" Binding="{Binding To}" Width="100" FontWeight="Bold"/>
                    <DataGridTextColumn Header="Distancia" Binding="{Binding Distance}" Width="100"/>
                    <DataGridTextColumn Header="Acumulado" Binding="{Binding Accumulator}" Width="100"/>
                    <DataGridTextColumn Header="Dirección" Binding="{Binding Direction}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#555"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Window>
